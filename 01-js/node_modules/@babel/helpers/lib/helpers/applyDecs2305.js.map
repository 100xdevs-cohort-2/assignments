{"version":3,"names":["_checkInRHS","require","_bindPropCall","obj","name","_this","value","call","createAddInitializerMethod","initializers","decoratorFinishedRef","addInitializer","initializer","v","Error","assertCallable","push","memberDec","dec","thisArg","desc","kind","isStatic","isPrivate","hasPrivateBrand","metadata","assertInstanceIfPrivate","callback","target","TypeError","ctx","static","private","get","set","t","has","bind","access","fn","hint","throwUndefined","assertValidReturnValue","type","init","applyMemberDec","ret","base","decInfo","decoratorsHaveThis","decs","decVal","Array","isArray","Object","getOwnPropertyDescriptor","newValue","inc","i","length","undefined","newInit","instance","ownInitializers","originalInitializer","Function","defineProperty","applyMemberDecs","Class","decInfos","instanceBrand","protoInitializers","staticInitializers","staticBrand","existingProtoNonFields","Map","existingStaticNonFields","pushInitializers","_","checkInRHS","prototype","existingNonFields","existingKind","applyClassDecs","targetClass","classDecs","newClass","nextNewClass","defineMetadata","Symbol","for","configurable","enumerable","applyDecs2305","memberDecs","classDecsHaveThis","parentClass","arguments","parentMetadata","create","e","c"],"sources":["../../src/helpers/applyDecs2305.ts"],"sourcesContent":["/* @minVersion 7.21.0 */\n\n// @ts-expect-error helper\nimport checkInRHS from \"checkInRHS\";\n\n/**\n  Enums are used in this file, but not assigned to vars to avoid non-hoistable values\n*/\n\nconst enum PROP_KIND {\n  FIELD = 0,\n  ACCESSOR = 1,\n  METHOD = 2,\n  GETTER = 3,\n  SETTER = 4,\n  CLASS = 5, // only used in assertValidReturnValue\n\n  STATIC = 8,\n\n  DECORATORS_HAVE_THIS = 16,\n}\n\ntype DecoratorFinishedRef = { v: boolean };\ntype DecoratorContextAccess = {\n  get?: (target: object) => any;\n  set?: (target: object, value: any) => void;\n  has: (target: object) => boolean;\n};\ntype DecoratorContext = {\n  kind: \"accessor\" | \"method\" | \"getter\" | \"setter\" | \"field\" | \"class\";\n  name: string;\n  static: boolean;\n  private: boolean;\n  access?: DecoratorContextAccess;\n  metadata?: any;\n  addInitializer?: (initializer: Function) => void;\n};\ntype DecoratorInfo = [\n  fn: Function | Function[],\n  kind: PROP_KIND,\n  name: string,\n  any?,\n  Function?,\n];\n\nfunction _bindPropCall(obj: any, name: string) {\n  return function (_this: any, value?: any) {\n    return obj[name].call(_this, value);\n  };\n}\n\nfunction createAddInitializerMethod(\n  initializers: Function[],\n  decoratorFinishedRef: DecoratorFinishedRef,\n) {\n  return function addInitializer(initializer: Function) {\n    if (decoratorFinishedRef.v) {\n      throw new Error(\n        \"attempted to call addInitializer after decoration was finished\",\n      );\n    }\n    assertCallable(initializer, \"An initializer\", true);\n    initializers.push(initializer);\n  };\n}\n\nfunction memberDec(\n  dec: Function,\n  thisArg: any,\n  name: string,\n  desc: PropertyDescriptor,\n  initializers: Function[],\n  kind: PROP_KIND,\n  isStatic: boolean,\n  isPrivate: boolean,\n  value: any,\n  hasPrivateBrand: Function,\n  metadata: any,\n) {\n  function assertInstanceIfPrivate(callback: Function) {\n    return function (target: any, value?: any) {\n      if (!hasPrivateBrand(target)) {\n        throw new TypeError(\n          \"Attempted to access private element on non-instance\",\n        );\n      }\n      return callback(target, value);\n    };\n  }\n\n  var decoratorFinishedRef = { v: false };\n  var ctx: DecoratorContext = {\n    kind: [\"field\", \"accessor\", \"method\", \"getter\", \"setter\", \"field\"][\n      kind\n    ] as any,\n\n    name: isPrivate ? \"#\" + name : name,\n    static: isStatic,\n    private: isPrivate,\n    metadata: metadata,\n    addInitializer: createAddInitializerMethod(\n      initializers,\n      decoratorFinishedRef,\n    ),\n  };\n\n  var get, set;\n  if (!isPrivate && (kind === PROP_KIND.FIELD || kind === PROP_KIND.METHOD)) {\n    get = function (target: any) {\n      return target[name];\n    };\n    if (kind === PROP_KIND.FIELD) {\n      set = function (target: any, v: any) {\n        target[name] = v;\n      };\n    }\n  } else if (kind === PROP_KIND.METHOD) {\n    // Assert: isPrivate is true.\n    get = assertInstanceIfPrivate(function () {\n      return desc.value;\n    });\n  } else {\n    // Assert: If kind === 0, then isPrivate is true.\n    var t = kind === PROP_KIND.FIELD || kind === PROP_KIND.ACCESSOR;\n    if (t || kind === PROP_KIND.GETTER) {\n      get = _bindPropCall(desc, \"get\");\n      if (isPrivate) {\n        get = assertInstanceIfPrivate(get);\n      }\n    }\n    if (t || kind === PROP_KIND.SETTER) {\n      set = _bindPropCall(desc, \"set\");\n      if (isPrivate) {\n        set = assertInstanceIfPrivate(set);\n      }\n    }\n  }\n  var has = isPrivate\n    ? // @ts-expect-error no thisArg\n      hasPrivateBrand.bind()\n    : function (target: object) {\n        return name in target;\n      };\n  var access: DecoratorContextAccess = (ctx.access = { has: has });\n  if (get) access.get = get;\n  if (set) access.set = set;\n\n  try {\n    return dec.call(thisArg, value, ctx);\n  } finally {\n    decoratorFinishedRef.v = true;\n  }\n}\n\nfunction assertCallable(fn: any, hint: string, throwUndefined?: boolean) {\n  if (typeof fn !== \"function\") {\n    if (throwUndefined || fn !== void 0) {\n      throw new TypeError(hint + \" must be a function\");\n    }\n  }\n}\n\nfunction assertValidReturnValue(kind: PROP_KIND, value: any) {\n  var type = typeof value;\n\n  if (kind === PROP_KIND.ACCESSOR) {\n    if (type !== \"object\" || !value) {\n      throw new TypeError(\n        \"accessor decorators must return an object with get, set, or init properties or void 0\",\n      );\n    }\n    assertCallable(value.get, \"accessor.get\");\n    assertCallable(value.set, \"accessor.set\");\n    assertCallable(value.init, \"accessor.init\");\n  } else if (type !== \"function\") {\n    throw new TypeError(\n      (kind === PROP_KIND.FIELD\n        ? \"field\"\n        : kind === PROP_KIND.CLASS\n          ? \"class\"\n          : \"method\") + \" decorators must return a function or void 0\",\n    );\n  }\n}\n\nfunction applyMemberDec(\n  ret: Function[],\n  base: any,\n  decInfo: DecoratorInfo,\n  decoratorsHaveThis: number,\n  name: string,\n  kind: PROP_KIND,\n  isStatic: boolean,\n  isPrivate: boolean,\n  initializers: Function[],\n  hasPrivateBrand: Function,\n  metadata: any,\n) {\n  var decs = decInfo[0],\n    decVal = decInfo[3];\n\n  if (!decoratorsHaveThis && !Array.isArray(decs)) {\n    decs = [decs];\n  }\n\n  var desc: PropertyDescriptor, init, value: any;\n\n  if (isPrivate) {\n    if (kind === PROP_KIND.FIELD || kind === PROP_KIND.ACCESSOR) {\n      desc = {\n        get: function (this: any) {\n          return decVal(this);\n        },\n        set: function (this: any, value: any) {\n          decInfo[4](this, value);\n        },\n      };\n    } else {\n      if (kind === PROP_KIND.GETTER) {\n        desc = {\n          get: decVal,\n        };\n      } else if (kind === PROP_KIND.SETTER) {\n        desc = {\n          set: decVal,\n        };\n      } else {\n        desc = {\n          value: decVal,\n        };\n      }\n    }\n  } else if (kind !== PROP_KIND.FIELD) {\n    desc = Object.getOwnPropertyDescriptor(base, name);\n  }\n\n  if (kind === PROP_KIND.ACCESSOR) {\n    value = {\n      get: desc.get,\n      set: desc.set,\n    };\n  } else if (kind === PROP_KIND.METHOD) {\n    value = desc.value;\n  } else if (kind === PROP_KIND.GETTER) {\n    value = desc.get;\n  } else if (kind === PROP_KIND.SETTER) {\n    value = desc.set;\n  }\n\n  var newValue, get, set;\n\n  var inc = decoratorsHaveThis ? 2 : 1;\n\n  for (var i = decs.length - 1; i >= 0; i -= inc) {\n    var dec = (decs as Function[])[i];\n\n    newValue = memberDec(\n      dec,\n      decoratorsHaveThis ? (decs as Function[])[i - 1] : undefined,\n      name,\n      desc,\n      initializers,\n      kind,\n      isStatic,\n      isPrivate,\n      value,\n      hasPrivateBrand,\n      metadata,\n    );\n\n    if (newValue !== void 0) {\n      assertValidReturnValue(kind, newValue);\n      var newInit;\n\n      if (kind === PROP_KIND.FIELD) {\n        newInit = newValue;\n      } else if (kind === PROP_KIND.ACCESSOR) {\n        newInit = newValue.init;\n        get = newValue.get || value.get;\n        set = newValue.set || value.set;\n\n        value = { get: get, set: set };\n      } else {\n        value = newValue;\n      }\n\n      if (newInit !== void 0) {\n        if (init === void 0) {\n          init = newInit;\n        } else if (typeof init === \"function\") {\n          init = [init, newInit];\n        } else {\n          init.push(newInit);\n        }\n      }\n    }\n  }\n\n  if (kind === PROP_KIND.FIELD || kind === PROP_KIND.ACCESSOR) {\n    if (init === void 0) {\n      // If the initializer was void 0, sub in a dummy initializer\n      init = function (instance: any, init: any) {\n        return init;\n      };\n    } else if (typeof init !== \"function\") {\n      var ownInitializers = init;\n\n      init = function (instance: any, init: any) {\n        var value = init;\n\n        for (var i = ownInitializers.length - 1; i >= 0; i--) {\n          value = ownInitializers[i].call(instance, value);\n        }\n\n        return value;\n      };\n    } else {\n      var originalInitializer = init;\n\n      init = init.call.bind(originalInitializer);\n    }\n\n    ret.push(init);\n  }\n\n  if (kind !== PROP_KIND.FIELD) {\n    if (kind === PROP_KIND.ACCESSOR) {\n      desc.get = value.get;\n      desc.set = value.set;\n    } else if (kind === PROP_KIND.METHOD) {\n      desc.value = value;\n    } else if (kind === PROP_KIND.GETTER) {\n      desc.get = value;\n    } else if (kind === PROP_KIND.SETTER) {\n      desc.set = value;\n    }\n\n    if (isPrivate) {\n      if (kind === PROP_KIND.ACCESSOR) {\n        ret.push(_bindPropCall(desc, \"get\"), _bindPropCall(desc, \"set\"));\n      } else {\n        ret.push(kind === PROP_KIND.METHOD ? value : Function.call.bind(value));\n      }\n    } else {\n      Object.defineProperty(base, name, desc);\n    }\n  }\n}\n\nfunction applyMemberDecs(\n  Class: any,\n  decInfos: DecoratorInfo[],\n  instanceBrand: Function,\n  metadata: any,\n) {\n  var ret: Function[] = [];\n  var protoInitializers;\n  var staticInitializers;\n  var staticBrand;\n\n  var existingProtoNonFields = new Map();\n  var existingStaticNonFields = new Map();\n\n  function pushInitializers(initializers: Function[]) {\n    if (initializers) {\n      ret.push(function (instance: any) {\n        for (var i = 0; i < initializers.length; i++) {\n          initializers[i].call(instance);\n        }\n        return instance;\n      });\n    }\n  }\n\n  for (var i = 0; i < decInfos.length; i++) {\n    var decInfo = decInfos[i];\n\n    // skip computed property names\n    if (!Array.isArray(decInfo)) continue;\n\n    var kind = decInfo[1];\n    var name = decInfo[2];\n    var isPrivate = decInfo.length > 3;\n\n    var decoratorsHaveThis = kind & PROP_KIND.DECORATORS_HAVE_THIS;\n    var isStatic = !!(kind & PROP_KIND.STATIC);\n    var base;\n    var initializers;\n    var hasPrivateBrand = instanceBrand;\n\n    kind &= 7 /* 0b111 */;\n\n    if (isStatic) {\n      base = Class;\n      // initialize staticInitializers when we see a static member\n      staticInitializers = staticInitializers || [];\n      initializers = staticInitializers;\n      if (isPrivate && !staticBrand) {\n        staticBrand = function (_: any) {\n          return checkInRHS(_) === Class;\n        };\n      }\n      hasPrivateBrand = staticBrand;\n    } else {\n      base = Class.prototype;\n      // initialize protoInitializers when we see a non-static member\n      protoInitializers = protoInitializers || [];\n      initializers = protoInitializers;\n    }\n\n    if (kind !== PROP_KIND.FIELD && !isPrivate) {\n      var existingNonFields = isStatic\n        ? existingStaticNonFields\n        : existingProtoNonFields;\n\n      var existingKind = existingNonFields.get(name) || 0;\n\n      if (\n        existingKind === true ||\n        (existingKind === PROP_KIND.GETTER && kind !== PROP_KIND.SETTER) ||\n        (existingKind === PROP_KIND.SETTER && kind !== PROP_KIND.GETTER)\n      ) {\n        throw new Error(\n          \"Attempted to decorate a public method/accessor that has the same name as a previously decorated public method/accessor. This is not currently supported by the decorators plugin. Property name was: \" +\n            name,\n        );\n      }\n      existingNonFields.set(\n        name,\n        !existingKind && kind > PROP_KIND.METHOD ? kind : true,\n      );\n    }\n\n    applyMemberDec(\n      ret,\n      base,\n      decInfo,\n      decoratorsHaveThis,\n      name,\n      kind,\n      isStatic,\n      isPrivate,\n      initializers,\n      hasPrivateBrand,\n      metadata,\n    );\n  }\n\n  pushInitializers(protoInitializers);\n  pushInitializers(staticInitializers);\n  return ret;\n}\n\nfunction applyClassDecs(\n  targetClass: any,\n  classDecs: Function[],\n  decoratorsHaveThis: number,\n  metadata: any,\n) {\n  if (classDecs.length) {\n    var initializers: Function[] = [];\n    var newClass = targetClass;\n    var name = targetClass.name;\n\n    var inc = decoratorsHaveThis ? 2 : 1;\n\n    for (var i = classDecs.length - 1; i >= 0; i -= inc) {\n      var decoratorFinishedRef = { v: false };\n\n      try {\n        var nextNewClass = classDecs[i].call(\n          decoratorsHaveThis ? classDecs[i - 1] : undefined,\n          newClass,\n          {\n            kind: \"class\",\n            name: name,\n            addInitializer: createAddInitializerMethod(\n              initializers,\n              decoratorFinishedRef,\n            ),\n            metadata,\n          },\n        );\n      } finally {\n        decoratorFinishedRef.v = true;\n      }\n\n      if (nextNewClass !== undefined) {\n        assertValidReturnValue(PROP_KIND.CLASS, nextNewClass);\n        newClass = nextNewClass;\n      }\n    }\n\n    return [\n      defineMetadata(newClass, metadata),\n      function () {\n        for (var i = 0; i < initializers.length; i++) {\n          initializers[i].call(newClass);\n        }\n      },\n    ];\n  }\n  // The transformer will not emit assignment when there are no class decorators,\n  // so we don't have to return an empty array here.\n}\n\nfunction defineMetadata(Class: any, metadata: any) {\n  return Object.defineProperty(\n    Class,\n    Symbol.metadata || Symbol.for(\"Symbol.metadata\"),\n    { configurable: true, enumerable: true, value: metadata },\n  );\n}\n\n/**\n  Basic usage:\n\n  applyDecs(\n    Class,\n    [\n      // member decorators\n      [\n        decs,               // dec, or array of decs, or array of this values and decs\n        0,                  // kind of value being decorated\n        'prop',             // name of public prop on class containing the value being decorated,\n        '#p',               // the name of the private property (if is private, void 0 otherwise),\n      ]\n    ],\n    [\n      // class decorators\n      dec1, dec2\n    ]\n  )\n  ```\n\n  Fully transpiled example:\n\n  ```js\n  @dec\n  class Class {\n    @dec\n    a = 123;\n\n    @dec\n    #a = 123;\n\n    @dec\n    @dec2\n    accessor b = 123;\n\n    @dec\n    accessor #b = 123;\n\n    @dec\n    c() { console.log('c'); }\n\n    @dec\n    #c() { console.log('privC'); }\n\n    @dec\n    get d() { console.log('d'); }\n\n    @dec\n    get #d() { console.log('privD'); }\n\n    @dec\n    set e(v) { console.log('e'); }\n\n    @dec\n    set #e(v) { console.log('privE'); }\n  }\n\n\n  // becomes\n  let initializeInstance;\n  let initializeClass;\n\n  let initA;\n  let initPrivA;\n\n  let initB;\n  let initPrivB, getPrivB, setPrivB;\n\n  let privC;\n  let privD;\n  let privE;\n\n  let Class;\n  class _Class {\n    static {\n      let ret = applyDecs(\n        this,\n        [\n          [dec, 0, 'a'],\n          [dec, 0, 'a', (i) => i.#a, (i, v) => i.#a = v],\n          [[dec, dec2], 1, 'b'],\n          [dec, 1, 'b', (i) => i.#privBData, (i, v) => i.#privBData = v],\n          [dec, 2, 'c'],\n          [dec, 2, 'c', () => console.log('privC')],\n          [dec, 3, 'd'],\n          [dec, 3, 'd', () => console.log('privD')],\n          [dec, 4, 'e'],\n          [dec, 4, 'e', () => console.log('privE')],\n        ],\n        [\n          dec\n        ]\n      );\n\n      initA = ret[0];\n\n      initPrivA = ret[1];\n\n      initB = ret[2];\n\n      initPrivB = ret[3];\n      getPrivB = ret[4];\n      setPrivB = ret[5];\n\n      privC = ret[6];\n\n      privD = ret[7];\n\n      privE = ret[8];\n\n      initializeInstance = ret[9];\n\n      Class = ret[10]\n\n      initializeClass = ret[11];\n    }\n\n    a = (initializeInstance(this), initA(this, 123));\n\n    #a = initPrivA(this, 123);\n\n    #bData = initB(this, 123);\n    get b() { return this.#bData }\n    set b(v) { this.#bData = v }\n\n    #privBData = initPrivB(this, 123);\n    get #b() { return getPrivB(this); }\n    set #b(v) { setPrivB(this, v); }\n\n    c() { console.log('c'); }\n\n    #c(...args) { return privC(this, ...args) }\n\n    get d() { console.log('d'); }\n\n    get #d() { return privD(this); }\n\n    set e(v) { console.log('e'); }\n\n    set #e(v) { privE(this, v); }\n  }\n\n  initializeClass(Class);\n */\n\nexport default function applyDecs2305(\n  targetClass: object,\n  memberDecs: DecoratorInfo[],\n  classDecs: Function[],\n  classDecsHaveThis: number,\n  instanceBrand: Function,\n  parentClass: any,\n) {\n  if (arguments.length >= 6) {\n    var parentMetadata =\n      parentClass[Symbol.metadata || Symbol.for(\"Symbol.metadata\")];\n  }\n  var metadata = Object.create(\n    parentMetadata === void 0 ? null : parentMetadata,\n  );\n  var e = applyMemberDecs(targetClass, memberDecs, instanceBrand, metadata);\n  if (!classDecs.length) defineMetadata(targetClass, metadata);\n  return {\n    e: e,\n    // Lazily apply class decorations so that member init locals can be properly bound.\n    get c() {\n      return applyClassDecs(\n        targetClass,\n        classDecs,\n        classDecsHaveThis,\n        metadata,\n      );\n    },\n  };\n}\n"],"mappings":"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"}